<!DOCTYPE html>
<html lang="en"  xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Members</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/main.css">
</head>
<body class="members_info">
<header>
    <div id="heading">
        <img src="/images/Nitrouz_Studioz.png" id="Nit_Studioz">
        <img class="footerImage" src="/images/twitter.png">
        <img class="footerImage" src="/images/twitch.png">
        <div id="login_logout">
            <p th:if="${loggedOut}" id="loginLink"><a href="/signup">Login/Sign Up</a></p>
            <div th:if="${loggedIn}" id="logoutLink">
                <p id="profile_name" th:text="${profileEntity.getProfileName()}"></p>
                <a href="/logOut">Log Out</a>
            </div>
        </div>
    </div>
    <nav>
        <ul id="nav">
            <li class="navbar"><a th:href="${loggedOut} ? '/' : '/LoggedInUser/index'">Home</a></li>
            <li class="navbar">
                <div class="dropdown">
                    <a href="">News</a>
                    <div class="dropdown_content">
                        <a href="">Reviews</a>
                    </div>
                </div>
            </li>
            <li class="navbar"><a href="">ESPORTS</a></li>
            <li class="navbar">
                <div class="dropdown">
                    <a href="">Live Streams</a>
                    <div class="dropdown_content">
                        <a href="">Twitch</a>
                        <a href="">Youtube</a>
                    </div>
                </div>
            </li>
            <li class="navbar"><a href="">Store</a></li>
            <li class="navbar">
                <div class="dropdown">
                    <a href="">Forums</a>
                    <div class="dropdown_content active">
                        <a th:href="${loggedOut} ? '/members' : '/LoggedInUser/members'">Members</a>
                    </div>
                </div>
            </li>
            <li class="navbar"><a th:href="${loggedOut} ? '/about' : '/LoggedInUser/about'">About</a></li>
        </ul>
    </nav>
</header>
<h1 th:if="${loggedOut}">Please log in to see Members</h1>
<div th:if="${loggedIn}" class="grid_container members">
    <div th:if="${loggedIn}" th:each="profile: ${profiles}" class="grid_item">
        <img th:src="${(profile.profilePic != null) ? profile.profilePic : '/images/empty_profile_pic.png'}" class="profile_pic"/>
        <p th:text="${profile.profileName}"></p>
        <div th:if="${profileEntity.getProfileName()} != ${profile.profileName}" class="like_follow">
<!--            <button class="like_button" th:classappend="${#lists.contains(liked_profiles, profile)} ? like : unlike" th:value="${profile.email}">-->
<!--                <i class="fa fa-thumbs-o-up" style="font-size:24px"></i>-->
<!--            </button>-->

            <button th:if="!${#lists.contains(liked_profiles, profile)}" class="like_button" th:attr="onclick=|likeProfile('${profile.email}')|">
                <i class="fa fa-thumbs-o-up" style="font-size:24px"></i>
            </button>
            <button th:if="${#lists.contains(liked_profiles, profile)}" class="unlike_button" th:attr="onclick=|unlike('${profile.email}')|">
                <i class="fa fa-thumbs-o-up" style="font-size:24px"></i>
            </button>
            <button th:if="!${#lists.contains(followed_profiles, profile)}" th:attr="onclick=|followProfile('${profile.email}')|" class="follow_button">
                Follow
            </button>
            <button th:if="${#lists.contains(followed_profiles, profile)}" th:attr="onclick=|unfollow('${profile.email}')|" class="unfollow_button">
                Unfollow
            </button>
        </div>
    </div>
</div>

<script th:inline="javascript">
    if([[${loggedIn}]]){
    //     $('button.like_button').delegate('click', function (e){
    //         let email;
    //         e.preventDefault();
    //         if($(this).hasClass("like")){
    //             email = $(this).val();
    //             fetch("/api/like/" + email)
    //                 .then(res => console.log("Response, " + res))
    //                 .catch(err => console.log("Error, " + err))
    //             $(this).removeClass("like");
    //             $(this).addClass("unlike")
    //         }
    //         if($(this).hasClass("unlike")){
    //             email = $(this).val();
    //             fetch("/api/unlike/" + email)
    //                 .then(res => console.log("Response, " + res))
    //                 .catch(err => console.log("Error, " + err))
    //             $(this).removeClass("unlike");
    //             $(this).addClass("like");
    //         }
    //     })

        function likeProfile(email){
            fetch("/api/like/" + email)
                .then(res => console.log("Response, " + res))
                .catch(err => console.log("Error, " + err))
        }

        function followProfile(email){
            fetch("/api/follow/" + email)
                .then(res => console.log("Response, " + res))
                .catch(err => console.log("Error, " + err))
        }

        function unlike(email){
            fetch("/api/unlike/" + email)
                .then(res => console.log("Response, " + res))
                .catch(err => console.log("Error, " + err))
        }

        function unfollow(email){
            fetch("/api/unfollow/" + email)
                .then(res => console.log("Response, " + res))
                .catch(err => console.log("Error, " + err))
        }
    }
</script>
</body>
</html>